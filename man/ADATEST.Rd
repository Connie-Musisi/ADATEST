% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/ADATEST_function.R
\name{ADATEST}
\alias{ADATEST}
\title{Adaptive Test for Differential Abundance Analysis}
\usage{
ADATEST(
  physeq,
  group_var = "group",
  group_levels = c("0", "1"),
  t0 = 1,
  t1 = 1.5,
  t2 = +Inf,
  B = 1000,
  empirical_adjust = TRUE,
  p.adjust.method = "BH",
  n.taxa0 = NULL,
  seed = set.seed(19)
)
}
\arguments{
\item{physeq}{A phyloseq object containing microbiome OTU/ASV count data.}

\item{group_var}{Name of the grouping variable in sample metadata (default: "group").}

\item{group_levels}{A character vector of two levels in \code{group_var} to be compared (default: c("0", "1")).}

\item{t0}{Lower threshold for effect size classification (default: 1).}

\item{t1}{Upper threshold for moderate effect classification (default: 1.5).}

\item{t2}{Maximum bound for strong effect classification (default: +Inf).}

\item{B}{Number of permutations for significance testing (default: 1000).}

\item{empirical_adjust}{Logical. If TRUE, applies empirical adjustment for unequal group sizes (default: TRUE).}

\item{p.adjust.method}{Method for p-value adjustment; options include "BH", "bonferroni", "fdr", etc. (default: "BH").}

\item{n.taxa0}{Number of non-differentially abundant taxa, if known. Used for tuning (default: NULL).}

\item{seed}{Random seed for reproducibility (default: \code{set.seed(19)}).}
}
\value{
A named \code{list} with components:
\describe{
\item{Original_results}{\code{data.frame} of the permutation test output on the original dataset,
containing columns:
\describe{
\item{Taxon}{feature identifier}
\item{Stat_Obs}{observed test statistic}
\item{p}{raw permutation p-value}
\item{p.adjusted}{adjusted p-value via \code{p.adjust.method}}
\item{DA}{logical indicator of differential abundance at the chosen FDR level}
}
}
\item{Train_results}{\code{list} containing:
\describe{
\item{Train_parest}{estimated score parameters from the training phase (PLS coefficients)}
\item{Train_performance}{metrics (e.g., accuracy, AUC) evaluating predictive fit on pseudo-data}
\item{Train_scaled}{rescaled training matrix used for scoring}}
}
\item{Unscaled_data}{\code{list} with:
\describe{
\item{Original_data}{the trimmed-and-TSS-normalized \code{phyloseq} object passed to training}
\item{Train_data}{pseudo-taxa training data before scaling or permutation}}
}
\item{Scaled_data}{\code{list} with:
\describe{
\item{Original_scaled}{rescaled counts of the original dataset used in test statistic computation}
\item{Train_scaled}{rescaled counts of pseudo-data used for training}}
}
\item{Pseudo_results}{output from \code{PseudoData()}, including pseudo-taxa summaries and thresholds}
\item{p_value}{numeric vector of raw p-values (extracted from \code{Original_results}$p)}
\item{p_adj}{numeric vector of adjusted p-values (extracted from \code{Original_results}$p.adjusted)}
\item{test_statistic}{numeric vector of observed test statistics (extracted from \code{Original_results}$Stat_Obs)}
}
\item  {data_Adjust2Median}{Data corrected for compositionality}
}
\description{
This function performs an adaptive differential abundance test (ADATEST) using a permutation-based approach.
It applies total sum scaling (TSS), trims the dataset to remove taxa that are not prevalent, reaarranges the groups
subsets the data to create the Pseudo dataset and finally the training dataset,
performs parameter estimation, conducts a permutation test, and evaluates performance metrics.
}
\details{
ADATEST adapts to dataset-specific characteristics via a three-step procedure:
\enumerate{
\item \strong{Trimming & Scaling}: Applies TSS and filters low-prevalence taxa to mitigate sparsity.
\item \strong{Pseudo-Data Generation & Training}: Constructs pseudo-taxa from the larger group, assigns labels
based on effect-size thresholds (\code{t0}, \code{t1}, \code{t2}), and fits a PLS model to estimate
adaptive scores.
\item \strong{Permutation Testing}: Computes test statistics on the real data using estimated scores,
permutes sample labels \code{B} times, then derives p-values and controls FDR via \code{p.adjust}.
}
}
